<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.axiasoft.vote_back.admin.dao">
    <select id="selectLogin" parameterType="hashmap" resultType="hashmap">
        SELECT *
        FROM axia.admin
        WHERE ad_id = #{ad_id}
        AND ad_pw = #{ad_password}
    </select>

    <select id="selectLatestRound" resultType="int">
        SELECT round
        FROM axia.vote_round
        ORDER BY round DESC
        LIMIT 1
    </select>

    <select id="selectStartRound" resultType="int">
        SELECT round
        FROM axia.vote_round
        WHERE start_date > now()
        ORDER BY round
        LIMIT 1
    </select>

    <select id="selectVoteResult" parameterType="hashmap" resultType="hashmap">
        SELECT vt_round as round,
               vt_target as coin_idx,
               COUNT(*) OVER (PARTITION BY vt_target) as count
        FROM axia.vote_result
        WHERE vt_round = #{round}
        ORDER BY vt_round, vt_target;
    </select>

    <select id="selectLatestVoteResult" resultType="hashmap">
        SELECT vt_round as round,
               vt_target as coin_idx,
               COUNT(*) OVER (PARTITION BY vt_target) as count
        FROM axia.vote_result
        WHERE vt_round = (SELECT MAX(vt_round) FROM axia.vote_result)
        ORDER BY vt_target
    </select>
    
    <select id="selectCurrentRound" resultType="hashmap">
        SELECT round
        FROM axia.vote_round
        WHERE now() between start_date and end_date
    </select>

    <insert id="insertCoin" parameterType="hashmap">
        INSERT INTO coin_list
            (coin_name, coin_info, coin_symbol,coin_pic,round_idx)
            VALUES (
                    #{coin_name},
                    #{coin_info},
                    #{coin_symbol},
                    #{coin_pic}
                    #{round}
                   )
    </insert>
</mapper>